---
title: "Covid19-México"
output: 
  html_document:
    orientation: columns
    vertical_layout: fill
    logo: logo2.png
    bootstrap_version: 4+3
    theme: cosmo
---

``` {r include=FALSE}
library(bootstraplib)
bs_theme_new()
# Color palette derives from https://tombrow.com/dark-mode-website-css
bs_theme_base_colors(bg = "#444", fg = "#e4e4e4")
bs_theme_accent_colors(primary = "#e39777", secondary = "#fdce93")
```

```{r setup, include=FALSE}
library(flexdashboard)
library(foreign)
library(ggeffects)
library(jtools)
library(huxtable)
library(ggplot2)
library(haven)
library(fastDummies)

D<-read_dta("COVID19.dta")
D1<-subset(D, D$resultado==1)


D1<-dummy_cols(D1, select_columns = c("obesidad","sector","diabetes","lastWeek","embarazo","intubado","asma", "tabaquismo", "inmusupr",
                                      "hipertension","renal_cronica","cardiovascular","habla_lengua_indig", "sexo"))

D1[,51:94]<-lapply(D1[,51:94], function(x) ifelse(x==0,.000000001,1))
```

```{r echo=FALSE, include=FALSE}
Model<- glm(death ~ 1 + f_gap + f_gap2  + sector_4 + sector_6 + sector_8 + sector_9 + sector_12 + sector_11  + edad + edad2 + habla_lengua_indig_2 + obesidad_2 + cardiovascular_2 + renal_cronica_2 + tabaquismo_2 + hipertension_2 + inmusupr_2 + asma_2 + diabetes_2 + embarazo_2 + sexo_1 + lastWeek_1 + lastWeek_2 + lastWeek_3, data = D1, family = "binomial", trace = TRUE, epsilon = 1e-10)
#export_summs(Model)
```

```{r eval=FALSE, include=FALSE, warning=FALSE, message=FALSE}
library(brms)
library(dplyr)
#D1a<-sample_n(D1,7000)


Model.B<-brm(death ~ 1 + f_gap + f_gap2  + sector_3 + sector_4 + sector_6 + sector_8 + sector_9 + sector_12 + sector_11  + edad + edad2 + habla_lengua_indig_1 + obesidad_2 + cardiovascular_2 + renal_cronica_2 + tabaquismo_2 + hipertension_2 + inmusupr_2 + asma_2 + diabetes_2 + embarazo_2 + sexo_1 + lastWeek_1 + lastWeek_2 + lastWeek_3, data = D1, prior = c(set_prior("normal(0,10)", class="b"),
                                set_prior("student_t(3,0,5)", class="Intercept"),
                                set_prior("normal(0,1)", class="b", coef="sexo_1"),
                                set_prior("normal(0,1)", class="b", coef="embarazo_2"),
                                set_prior("normal(0,1)", class="b", coef="sector_3"),
                                set_prior("normal(0,1)", class="b", coef="sector_4"),
                                set_prior("normal(0,1)", class="b", coef="sector_6"),
                                set_prior("normal(0,1)", class="b", coef="sector_11"),
                                set_prior("normal(0,1)", class="b", coef="sector_12"),
                                set_prior("normal(0,1)", class="b", coef="sector_8"),
                                set_prior("normal(0,1)", class="b", coef="sector_9")),
 family = "bernoulli", chains=4, cores=4, iter = 1000, control = list(max_treedepth = 12))

save(Model.B,file="Model.B")
```

```{r echo=FALSE}
load("Model.B")
```


## Probabilidad (prevalencia) ajustada: condiciones de salud y demográficas {.tabset} 

Esta sección muestra la prevalencia ajustada de fallecimientos según distintas condiciones demográficas y de salud. A diferencia de la  (<a href="https://hectornajera83.github.io/COVID19Mexico/COVID19_ws1.html"> prevalencia cruda</a>), se trata de probabilidades que permiten hacer conclusiones más robustas sobre los factores de riesgo de fallecimiento por COVID-19.

Todas las gráficas reconocen la incertidumbre de la estimación y se incluyen (<a href="https://en.wikipedia.org/wiki/Credible_interval" target="_blank">intervalos creíbles</a>) al 95% . Esto signfica que, con una probabilidad de 95%, el valor observado se ubica en el rango mostrado en la gráfica. 

Se recomienda leer la *Nota: Prevalencia ajustada*. 

### Edad

```{r echo=FALSE, warning=FALSE, message=FALSE}
edad.p<-ggpredict(Model.B, terms = c("edad [0:90]"))

ggplot(data=edad.p, aes(x, predicted*100)) + geom_ribbon(aes(ymin = conf.low*100, ymax = conf.high*100), fill = "#B4045F", alpha=.5) + 
  labs(x = "Edad", y = "Probabilidad de fallecimiento (%), 95% CI") + 
  geom_line() + theme_classic()
```

### Sexo

```{r echo=FALSE, warning=FALSE, message=FALSE}
sexo.m<-ggpredict(Model.B, terms = c("sexo_1"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               obesidad_2=.5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               hipertension_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))


sexo.r<-ggpredict(Model.B, terms = c("sexo_1"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               diabetes_2= .05,
                                                               obesidad_2= .05,
                                                               cardiovascular_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               hipertension_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

sexo.m$riesgo<-"Medio"
sexo.r$riesgo<-"Alto"
sexo<-rbind(sexo.m,sexo.r)


sexo$x<-ifelse(sexo$x==1,"Mujer","Hombre")

ggplot(sexo, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Sexo", y="Probabilidad fallecimiento (%). CI 95%", c) + 
   ylim(c(2,39)) + 
  theme_classic() +   scale_color_hue(l=30, c=80) 
```

### Indígena

```{r echo=FALSE, warning=FALSE, message=FALSE}
indigena.m<-ggpredict(Model.B, terms = c("habla_lengua_indig_1"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               obesidad_2=.5,
                                                               cardiovascular_2 = .5,
                                                               sexo_1 = .5,
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               hipertension_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))


indigena.r<-ggpredict(Model.B, terms = c("habla_lengua_indig_1"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               diabetes_2= .05,
                                                               obesidad_2= .05,
                                                               cardiovascular_2 = .05,
                                                               sexo = .5,
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               hipertension_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

indigena.m$riesgo<-"Medio"
indigena.r$riesgo<-"Alto"
indigena<-rbind(indigena.m,indigena.r)


indigena$x<-ifelse(indigena$x==1,"Habla lengua indígena","No habla lengua indígena")

ggplot(indigena, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Habla lengua indígena", y="Probabilidad fallecimiento (%). CI 95%", c) + 
   ylim(c(2,45)) + 
  theme_classic() +   scale_color_hue(l=20, c=76) 
```

### Obesidad

```{r echo=FALSE, warning=FALSE, message=FALSE}
obesidad.m<-ggpredict(Model.B, terms = c("obesidad_2"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               hipertension_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))

obesidad.r<-ggpredict(Model.B, terms = c("obesidad_2"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               diabetes_2= .05,
                                                               cardiovascular_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               hipertension_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

obesidad.m$riesgo<-"Medio"
obesidad.r$riesgo<-"Alto"
obesidad<-rbind(obesidad.m,obesidad.r)


obesidad$x<-ifelse(obesidad$x==1,"Sin Obesidad","Con Obesidad")

ggplot(obesidad, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Condición de obesidad", y="Probabilidad fallecimiento (%). CI 95%", color = "Riesgo factores de salud") + 
   ylim(c(4,35)) + 
  theme_classic() +   scale_color_hue(l=40, c=90) 


```

### Diabetes

```{r echo=FALSE, warning=FALSE, message=FALSE}
diabetes.m<-ggpredict(Model.B, terms = c("diabetes_2"), condition = c(tabaquismo_2 = .5,
                                                               obesidad_2= .5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               hipertension_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))

diabetes.r<-ggpredict(Model.B, terms = c("diabetes_2"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               obesidad_2= .05,
                                                               cardiovascular_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               hipertension_2 = .05,
                                                               inmusupr_2 = .05,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

diabetes.m$riesgo<-"Medio"
diabetes.r$riesgo<-"Alto"
diabetes<-rbind(diabetes.m,diabetes.r)

diabetes$x<-ifelse(diabetes$x==1,"Sin Diabetes","Con Diabetes")

ggplot(diabetes, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Condición de diabetes", y="Probabilidad fallecimiento (%). CI 95%", color = "Riesgo factores de salud") + 
   ylim(c(4,35)) + 
  theme_classic() +   scale_color_manual(values=c("#d64161", "#6b5b95"))

```

### Hipertensión

```{r echo=FALSE, warning=FALSE, message=FALSE}
hipertension.m<-ggpredict(Model.B, terms = c("hipertension_2"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               obesidad_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))

hipertension.r<-ggpredict(Model.B, terms = c("hipertension_2"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               obesidad_2= .05,
                                                               cardiovascular_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               diabetes_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

hipertension.m$riesgo<-"Medio"
hipertension.r$riesgo<-"Alto"
hipertension<-rbind(hipertension.m,hipertension.r)

hipertension$x<-ifelse(hipertension$x==1,"Sin hipertensión","Con hipertensión")

ggplot(hipertension, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Condición de hipertensión", y="Probabilidad fallecimiento (%). CI 95%", color = "Riesgo factores de salud") + 
   ylim(c(4,35)) + 
 theme_classic() + scale_color_manual(values=c("#484f4f", "#bd5734"))

```

### Cardiovascular

```{r echo=FALSE, warning=FALSE, message=FALSE}
cardiovascular.m<-ggpredict(Model.B, terms = c("cardiovascular_2"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               hipertension_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .5,
                                                               obesidad_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))

cardiovascular.r<-ggpredict(Model.B, terms = c("cardiovascular_2"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               obesidad_2= .05,
                                                               hipertension_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               renal_cronica_2 = .05,
                                                               diabetes_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

cardiovascular.m$riesgo<-"Medio"
cardiovascular.r$riesgo<-"Alto"
cardiovascular<-rbind(cardiovascular.m,cardiovascular.r)

cardiovascular$x<-ifelse(cardiovascular$x==1,"Sin cardiovascular","Con cardiovascular")

ggplot(cardiovascular, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Condición de enfermedad cardiovascular", y="Probabilidad fallecimiento (%). CI 95%", color = "Riesgo factores de salud") + 
   ylim(c(4,35)) + 
 theme_classic() + scale_color_manual(values=c("#051e3e", "#851e3e"))

```

### Enfermedad renal crónica

```{r echo=FALSE, warning=FALSE, message=FALSE}
renal.m<-ggpredict(Model.B, terms = c("renal_cronica_2"), condition = c(tabaquismo_2 = .5,
                                                               diabetes_2= .5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               hipertension_2 = .5,
                                                               obesidad_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = mean(D1$sector_3),
                                                               sector_4 = mean(D1$sector_4),
                                                               sector_6 = mean(D1$sector_6),
                                                               sector_8 = mean(D1$sector_8),
                                                               sector_9 = mean(D1$sector_9),
                                                               sector_11 = mean(D1$sector_11),
                                                               sector_12 = mean(D1$sector_12),
                                                               lastWeek_1 = mean(D1$lastWeek_1),
                                                               lastWeek_2 = mean(D1$lastWeek_2),
                                                               lastWeek_3 = mean(D1$lastWeek_3)))

renal.r<-ggpredict(Model.B, terms = c("renal_cronica_2"), ci.lvl = 0.90, condition = c(tabaquismo_2 = .05,
                                                               obesidad_2= .05,
                                                               cardiovascular_2 = .05,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               diabetes_2 = .05,
                                                               hipertension_2 = .05,
                                                               inmusupr_2 = .05,
                                                               asma_2 = .05,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))

renal.m$riesgo<-"Medio"
renal.r$riesgo<-"Alto"
renal<-rbind(renal.m,renal.r)

renal$x<-ifelse(renal$x==1,"Sin enfermedad renal","Con enfermedad renal")

ggplot(renal, aes(x = x, y = predicted*100, colour=riesgo, group=riesgo)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Enfermedad renal crónica", y="Probabilidad fallecimiento (%). CI 95%", color = "Riesgo factores de salud") + 
   ylim(c(4,35)) + 
 theme_classic() + scale_color_manual(values=c("#4a4e4d", "#fe8a71"))

```

### Interacción: Obesidad y Diabetes

```{r echo=FALSE, warning=FALSE, message=FALSE}
dia.obs<-ggpredict(Model.B, terms = c("diabetes_2", "obesidad_2"), condition = c(tabaquismo_2 = .5,
                                                               cardiovascular_2 = .5,
                                                               habla_lengua_indig_1 = mean(D1$habla_lengua_indig_1),
                                                               embarazo_2 = mean(D1$embarazo_2),
                                                               diabetes_2 = .5,
                                                               hipertension_2 = .5,
                                                               renal_cronica_2 = .5,
                                                               inmusupr_2 = .5,
                                                               asma_2 = .5,
                                                               sexo_1 = .5,
                                                               sector_3 = .1,
                                                               sector_4 = .1,
                                                               sector_6 = .1,
                                                               sector_8 = .1,
                                                               sector_9 = .1,
                                                               sector_11 = .1,
                                                               sector_12 = .1,
                                                               lastWeek_1 = .1,
                                                               lastWeek_2 = .1,
                                                               lastWeek_3 = .1))


dia.obs$diabetes<-c("Con diabetes","Sin diabetes", "Con diabetes","Sin diabetes")
dia.obs$obesidad<-c("Con obesidad","Con obesidad", "Sin obesidad","Sin obesidad")

ggplot(dia.obs, aes(x = obesidad, y = predicted*100, colour=diabetes, group=diabetes)) +
  geom_point(position=position_dodge(width=.3)) +
  geom_pointrange(aes(ymin = conf.low*100, ymax = conf.high*100), fatten = 8, position=position_dodge(width=.3)) + labs(x="Interacción obesidad y diabetes", y="Probabilidad fallecimiento (%). CI 95%. Riesgo medio", color = "Riesgo factores de salud") + 
   ylim(c(0,25)) + 
 theme_classic() + scale_color_manual(values=c("#f1602e", "#9e7e76")) +  theme(legend.position = "bottom")
```


### Nota: Probabilidad ajustada

#### Significado e interpretación

La probabilidad ajustada es la proporción de fallecimientos atribuibles a cierta característica (por ejemplo, obesidad) después de controlar por ciertos factores en un modelo estadístico. En el caso más simple, el control se hace a los valores promedio de los otros factores. En los casos más complicados el ajuste se hace a valores específicos. Por ejemplo, la probabilidad de fallecimiento para gente con obesidad para la población hipertensa, con diabetes, etc. 

Estos datos se interpretan de la siguiente manera. Considere a dos grupos de personas, uno con y otro sin diabetes, con probabilidades ajustadas de 25% y 15%, respectivamente. Esto significa que -en promedio- el efecto de diabetes sobre la probabilidad de fallecimiento es de 10%. En otras palabras, las personas con diabetes tienen 10% más riesgo de morir que las que no tienen diabetes. 

#### **Significado de riesgo medio y alto**

Riesgo medio: Es la probabilidad de fallecimiento atribuible para la característica en cuestión -e.g. diabetes- considerando las otras características a sus valores promedio. Es decir, es la probabilidad de fallecimiento para diabéticos y no diabéticos con valores promedio de edad, padecimientos, lugar de residencia, hospital de atención, etc. Es decir, el riesgo medio trata de aproximar la probabilidad de morir para una persona adulta "normal o típica".

Riesgo alto: Es la probabilidad de fallecimiento atribuible para la característica -e.g. diabetes- considerando que sus otras características -principalmente de salud- son de riesgo. Es decir, es la probabilidad de fallecimiento para diabéticos y no diabéticos que además tienen alto riesgo de enfermedad cardiovascular, renal crónica, obesidad, etc. No se trata, de la población típica en México.

#### **Método para cálculo de probabilidades**

Las probabilidades se obtienen en dos pasos:

* Estimación de modelo bayesiano de regresión binaria. Para la estimación se usaron los siguientes programas:

Rstan: 

Stan Development Team (2018). RStan: the R interface to Stan. R package version 2.18.2. http://mc-stan.org/

El paquete `brms()` de R: 

Paul-Christian Bürkner (2017). brms: An R Package for Bayesian Multilevel Models Using Stan. Journal of Statistical Software, 80(1), 1-28. doi:10.18637/jss.v080.i01

* Estimación de probabilidades a partir de los resultados del modelo.

Los paquetes `ggpredict()` de R. Con auxilio de `ggplot2()`. 

Lüdecke D (2018). “ggeffects: Tidy Data Frames of Marginal Effects from Regression Models.” _Journal of Open Source Software_, *3*(26), 772.
doi: 10.21105/joss.00772 (URL: http://doi.org/10.21105/joss.00772).

H. Wickham. ggplot2: Elegant Graphics for Data Analysis. Springer-Verlag New York, 2016.

* Datos

Los datos se actualizan diariamente con información oficial de: https://datos.gob.mx/busca/dataset/informacion-referente-a-casos-covid-19-en-mexico

